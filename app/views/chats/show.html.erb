<%= render "shared/navbar" %>

<div class="main">
  <div class="container">
    <div class="p-2">
      <%= link_to "#offcanvasmessagenavbar",
      role: "button",
      "data-bs-toggle": "offcanvas",
      "aria-controls": "offcanvasmessagenavbar",
      class: "btn" do %>
        <i class="fa-solid fa-magnifying-glass"></i>
      <% end %>
    </div>
    <div class="row message-area">
      <% @messages.each do |message| %>
        <div class="row">
          <div class="col mb-2">
            <% unless message.who_sent === 'user' %>
              <div id='<%= "message_#{message.id}"  %>' class="chat-box">
                <p class="chat-user-text-style"><%= message.who_sent %></p>
                <%= message.content.html_safe %>
              </div>
            <% end %>
          </div>
          <div class="col">
            <% if message.who_sent === 'user' %>
              <div id='<%= "message_#{message.id}"  %>'  class="chat-box">
                <p class="chat-user-text-style"><%= message.who_sent %></p>
                <%= message.content.html_safe %>
              </div>
            <% end %>
            <br>
          </div>
        </div>
      <% end %>
    </div>
    <div class="d-flex justify-content-between p-2">
      <%= simple_form_for [@chat, @message], method: :post, html: { class: 'w-100 text-area-div' } do |f| %>
        <div class="d-flex align-items-center mb-0">
          <%= f.hidden_field :who_sent, value: "user" %>
          <%= f.input :content, as: :text, required: false, label: false , wrapper: false, input_html: { class: 'text-area-reset text-area-style' }  %>
          <button type="submit" class="btn text-black">
            <i class="fa-solid fa-circle-up"></i>
          </button>
        </div>
      <% end %>
    </div>
  </div>
</div>
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasmessagenavbar" aria-labelledby="offcanvasmessagenavbarLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasmessagenavbarLabel">Old messages</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body" >
    <% @messages.each do |message| %>
      <% if message.who_sent === 'user' %>
        <div data-controller="messagenavbar">
          <%= link_to "#", class: "nav-link text-dark", data: { action: "click->messagenavbar#messageClick", messageId: message.id } do %>
            <div class="chat-box mb-2">
              <p><%= message.content %></p>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
